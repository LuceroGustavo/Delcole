<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${titulo}">Agregar producto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary mb-3">
        <div class="container-fluid">
            <a class="navbar-brand" th:href="@{/home}">← Kiosco Delcole</a>
        </div>
    </nav>
    <main class="container">
        <h4 class="mb-4" th:text="${titulo}">Agregar producto</h4>
        <form th:action="@{/api/productos}" th:object="${producto}" method="post" id="formProducto">
            <div class="mb-3">
                <label class="form-label">Código de barras (opcional)</label>
                <input type="text" class="form-control form-control-lg" th:field="*{codigoBarra}" placeholder="Escanear o dejar vacío">
            </div>
            <div class="mb-3">
                <label class="form-label">Nombre *</label>
                <input type="text" class="form-control form-control-lg" th:field="*{nombre}" required placeholder="Nombre del producto">
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Precio de compra</label>
                    <input type="number" step="0.01" class="form-control form-control-lg" th:field="*{precioCompra}" placeholder="0.00">
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Precio de venta *</label>
                    <input type="number" step="0.01" class="form-control form-control-lg" th:field="*{precioVenta}" required placeholder="0.00">
                </div>
            </div>
            <div class="row">
                <div class="col-6 mb-3">
                    <label class="form-label">Stock inicial</label>
                    <input type="number" class="form-control form-control-lg" th:field="*{stockActual}" min="0" placeholder="0">
                </div>
                <div class="col-6 mb-3">
                    <label class="form-label">Stock mínimo (alerta)</label>
                    <input type="number" class="form-control form-control-lg" th:field="*{stockMinimo}" min="0" placeholder="0">
                </div>
            </div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                <a th:href="@{/home}" class="btn btn-outline-secondary btn-lg">Cancelar</a>
                <button type="submit" class="btn btn-success btn-lg">Guardar</button>
            </div>
        </form>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('formProducto').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e.target;
            const data = {
                codigoBarra: form.codigoBarra.value || null,
                nombre: form.nombre.value,
                precioCompra: form.precioCompra.value ? parseFloat(form.precioCompra.value) : null,
                precioVenta: parseFloat(form.precioVenta.value) || 0,
                stockActual: parseInt(form.stockActual.value) || 0,
                stockMinimo: parseInt(form.stockMinimo.value) || 0,
                activo: true
            };
            fetch(form.action, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(r => r.ok ? r.json() : Promise.reject(r))
            .then(() => { window.location.href = '/home'; })
            .catch(() => alert('Error al guardar. Revisá los datos.'));
        });
    </script>
</body>
</html>
